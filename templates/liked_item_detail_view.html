<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã„ã„ã­è©³ç´°é–²è¦§ - {{ plan.name }}æ§˜ ({{ plan.created_at.strftime('%Y-%m-%d') }})</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        body {
            font-family: 'MS PGothic', 'ï¼­ï¼³ ï¼°ã‚´ã‚·ãƒƒã‚¯', sans-serif;
            font-size: 13px;
            background-color: #e0e0e0;
        }
        .container { max-width: 1250px; }
        .form-container {
            width: 1200px;
            margin: 20px auto;
            background-color: #fff;
            padding: 25px;
            border: 1px solid #333;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            border: 2px solid #000;
            margin-bottom: 15px;
        }
        th, td {
            border: 1px solid #000;
            padding: 5px 8px;
            vertical-align: top;
            line-height: 1.6;
        }
        th {
            background-color: #f2f2f2;
            text-align: center;
            font-weight: bold;
        }
        .value-text {
            font-weight: bold;
            color: #333;
            white-space: pre-wrap; /* æ”¹è¡Œã‚’åæ˜  */
            word-wrap: break-word; /* é•·ã„å˜èªã‚’æŠ˜ã‚Šè¿”ã™ */
        }
        .chk {
            font-weight: bold;
            margin-right: 10px;
        }
        .chk.checked::before {
            content: 'â˜‘ ';
            color: #0056b3;
        }
        .chk.unchecked::before {
            content: 'â˜ ';
            color: #ccc;
        }
        .radio.checked::before {
            content: 'â— ';
            color: #0056b3;
        }
        .radio.unchecked::before {
            content: 'â—‹ ';
        }
        .radio {
            margin-right: 10px;
        }
        .sub-item { padding-left: 20px; }
        .vertical-rl {
            writing-mode: vertical-rl;
            text-align: center;
            padding: 10px 5px;
            vertical-align: middle;
        }
        .text-center { text-align: center; }
        .notes { font-size: 11px; text-align: right; }
        .header-note { text-align: left; font-size: 14px; font-weight: bold; margin-bottom: 10px; }

        /* --- â–¼â–¼â–¼ ã„ã„ã­è©³ç´°è¡¨ç¤ºç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« â–¼â–¼â–¼ --- */
        .liked-item {
            background-color: #fffbe6 !important; /* è–„ã„é»„è‰² */
        }
        .suggestion-comparison {
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .suggestion-comparison-header {
            background-color: #f7f7f7;
            padding: 8px 12px;
            font-weight: bold;
            border-bottom: 1px solid #ddd;
        }
        .suggestion-box {
            padding: 12px;
            white-space: pre-wrap;
        }
        .suggestion-comparison-body {
            /* display: flex; ã‚’è§£é™¤ã—ã€ç¸¦ä¸¦ã³ã«ã™ã‚‹ */
        }
        .suggestion-box + .suggestion-box {
            /* 2ã¤ç›®ä»¥é™ã®suggestion-boxã®ä¸Šéƒ¨ã«å¢ƒç•Œç·šã‚’è¿½åŠ  */
            border-top: 1px solid #ddd;
        }
        .suggestion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: .3rem .75rem;
            background-color: #f0f2f5;
            border: 1px solid #dee2e6;
            border-bottom: none;
            border-radius: .25rem .25rem 0 0;
        }
        .suggestion-header .model-name {
            font-weight: bold;
            color: var(--primary-color);
        }
        .suggestion-body-wrapper {
            position: relative;
        }
        .suggestion-content {
            display: none;
        }
        .suggestion-content.active {
            display: block;
        }
        .suggestion-box h6 {
            font-weight: bold;
            color: #555;
            margin-top: 0;
            margin-bottom: 8px;
        }
        .liked-model-badge {
            display: inline-block;
            padding: 2px 6px;
            font-size: 11px;
            font-weight: bold;
            color: #fff;
            border-radius: 8px;
            margin-left: 5px;
        }
        .badge-general { background-color: #0d6efd; }
        .badge-specialized { background-color: #dc3545; }
        /* --- â–²â–²â–² ã„ã„ã­è©³ç´°è¡¨ç¤ºç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« â–²â–²â–² --- */
        /* --- â–¼â–¼â–¼ã€æ–°è¦ã€‘ã„ã„ã­å±¥æ­´ãƒãƒƒã‚¸ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« â–¼â–¼â–¼ --- */
        .history-badges {
            margin-top: 5px;
            margin-bottom: 5px;
        }
        .history-badge {
            display: inline-block;
            padding: 3px 8px;
            font-size: 11px;
            background-color: #6c757d;
            color: white;
            border-radius: 10px;
            text-decoration: none;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        .history-badge:hover {
            background-color: #5a6268;
            color: white;
        }
        /* --- â–¼â–¼â–¼ã€æ–°è¦ã€‘æŠ˜ã‚ŠãŸãŸã¿è¡¨ç¤ºç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« â–¼â–¼â–¼ --- */
        details.suggestion-details {
            margin-top: 10px;
        }
        details.suggestion-details summary {
            cursor: pointer;
            font-size: 12px;
            color: #0056b3;
            padding: 5px;
            border-radius: 4px;
        }
        /* --- â–²â–²â–²ã€æ–°è¦ã€‘ã„ã„ã­å±¥æ­´ãƒãƒƒã‚¸ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« â–²â–²â–² --- */

        @media print {
            body {
                background-color: #fff !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                font-size: 10pt;
            }
            .container { margin: 0; padding: 0; width: 100%; max-width: 100%; }
            .form-container { box-shadow: none; border: none; margin: 0; padding: 0; width: 100%; }
            .print-button, .back-to-master-button { display: none; }
            table { page-break-inside: auto; }
            tr { page-break-inside: avoid; page-break-after: auto; }
            thead { display: table-header-group; }
            .value-text { color: #000 !important; }
            .chk.checked::before, .radio.checked::before { color: #000 !important; }
            th, td { padding: 4px; line-height: 1.4; }
            th { background-color: #f2f2f2 !important; }
            .liked-item { background-color: #fffbe6 !important; }
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const suggestionContainers = document.querySelectorAll('.suggestion-container');
            const modelNames = ["é€šå¸¸ãƒ¢ãƒ‡ãƒ«", "ç‰¹åŒ–ãƒ¢ãƒ‡ãƒ«(RAG)"];

            suggestionContainers.forEach(container => {
                const switchBtns = container.querySelectorAll('.suggestion-switch-btn');
                const modelNameEl = container.querySelector('.model-name');
                const likeIndicatorContainer = container.querySelector('.like-indicator-container'); //ã€è¿½åŠ ã€‘
                const contents = container.querySelectorAll('.suggestion-content');
                let currentIndex = 0;

                const likedModel = container.dataset.likedModel;
                if (likedModel === 'specialized') {
                    currentIndex = 1;
                }

                 function updateView() {
                    // å…¨ã¦ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤ºã«ã™ã‚‹
                    contents.forEach(content => content.classList.remove('active'));
                    // ç¾åœ¨ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã¿è¡¨ç¤º
                    contents[currentIndex].classList.add('active');
                    // ãƒ¢ãƒ‡ãƒ«åã‚’æ›´æ–°
                    modelNameEl.textContent = modelNames[currentIndex];
 
                    //ã€ä¿®æ­£ã€‘ã„ã„ã­ãƒãƒ¼ã‚¯ã®è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¿®æ­£
                    const currentModelType = contents[currentIndex].dataset.modelType;
                    // likedModelã¯å˜ä¸€ã®æ–‡å­—åˆ—ã€‚likedModelsã¯é…åˆ—ã€‚
                    // data-liked-modelså±æ€§ã‹ã‚‰ã„ã„ã­ã•ã‚ŒãŸãƒ¢ãƒ‡ãƒ«ã®ãƒªã‚¹ãƒˆã‚’å–å¾—
                    const likedModels = (container.dataset.likedModels || '').split(',');
 
                    // ç¾åœ¨è¡¨ç¤ºä¸­ã®ãƒ¢ãƒ‡ãƒ«ãŒã€ã„ã„ã­ã•ã‚ŒãŸãƒ¢ãƒ‡ãƒ«ã®ãƒªã‚¹ãƒˆã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                    if (likedModels.includes(currentModelType)) {
                        likeIndicatorContainer.innerHTML = '<span class="liked-model-badge badge-general">ğŸ‘ ã„ã„ã­</span>';
                    } else {
                        likeIndicatorContainer.innerHTML = '';
                    }
                }

                switchBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        currentIndex = (btn.dataset.direction === 'next') ? (currentIndex + 1) % contents.length : (currentIndex - 1 + contents.length) % contents.length;
                        updateView();
                    });
                });

                // åˆæœŸè¡¨ç¤ºã‚’å®Ÿè¡Œ
                updateView();
            });
        });
    </script>
</head>
<body>
    <div class="container">
        <div class="form-container">
            <div class="header-note">(åˆ¥ç´™æ§˜å¼23) - ã„ã„ã­è©³ç´°</div>
            <table>
                <tbody>
                    <tr>
                        <th colspan="3">ãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿæ–½è¨ˆç”»æ›¸</th>
                    </tr>
                    <tr>
                        <td style="width: 33%;">æ‚£è€…æ°å: <span class="value-text">{{ plan.name or '' }}</span></td>
                        <td style="width: 33%;">
                            æ€§åˆ¥ ( <span class="value-text">{{ plan.gender or '' }}</span> )
                            | å¹´é½¢ ( <span class="value-text">{{ plan.age or '' }}</span> æ­³ )
                        </td>
                        <td style="width: 34%;">
                            è¨ˆç”»è©•ä¾¡å®Ÿæ–½æ—¥<br>
                            <span class="value-text">{{ plan.header_evaluation_date.strftime('%Yå¹´ %mæœˆ %dæ—¥') if plan.header_evaluation_date else '' }}</span>
                        </td>
                    </tr>
                    <tr>
                        <td>ç®—å®šç—…å: <span class="value-text">{{ plan.header_disease_name_txt or '' }}</span></td>
                        <td>æ²»ç™‚å†…å®¹:
                            <span class="chk {{ 'checked' if plan.header_therapy_pt_chk else 'unchecked' }}">ç†å­¦ç™‚æ³•</span>
                            <span class="chk {{ 'checked' if plan.header_therapy_ot_chk else 'unchecked' }}">ä½œæ¥­ç™‚æ³•</span>
                            <span class="chk {{ 'checked' if plan.header_therapy_st_chk else 'unchecked' }}">è¨€èªç™‚æ³•</span>
                        </td>
                        <td>
                            ç™ºç—‡æ—¥ãƒ»æ‰‹è¡“æ—¥: 
                            <span class="value-text">{{ plan.header_onset_date.strftime('%Yå¹´ %mæœˆ %dæ—¥') if plan.header_onset_date else '' }}</span>
                            <br>
                            ãƒªãƒé–‹å§‹æ—¥: 
                            <span class="value-text">{{ plan.header_rehab_start_date.strftime('%Yå¹´ %mæœˆ %dæ—¥') if plan.header_rehab_start_date else '' }}</span>
                        </td>
                    </tr>
                    <tr>
                        <td>ä½µå­˜ç–¾æ‚£ãƒ»åˆä½µç—‡<br><div class="value-text">{{ plan.main_comorbidities_txt or '' }}</div></td>
                        <td class="{{ 'liked-item' if details_map.get('main_risks_txt') and details_map.get('main_risks_txt').liked_model }}">
                            å®‰é™åº¦ãƒ»ãƒªã‚¹ã‚¯<br>
                            <div class="value-text">{{ plan.main_risks_txt or '' }}</div>
                            {% if details_map.get('main_risks_txt') %}
                                {% set detail = details_map.get('main_risks_txt') %}
                                {% if detail and detail.liked_model %}
                                    {# ã„ã„ã­ã‚ã‚Š: å¸¸ã«å±•é–‹ #}
                                    {% with suggestions=detail, final_text=plan.main_risks_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    {# ã„ã„ã­ãªã—: æŠ˜ã‚ŠãŸãŸã¿ #}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.main_risks_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                        <td class="{{ 'liked-item' if details_map.get('main_contraindications_txt') and details_map.get('main_contraindications_txt').liked_model }}">
                            ç¦å¿Œãƒ»ç‰¹è¨˜äº‹é …<br>
                            <div class="value-text">{{ plan.main_contraindications_txt or '' }}</div>
                            {% if details_map.get('main_contraindications_txt') %}
                                {% set detail = details_map.get('main_contraindications_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.main_contraindications_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.main_contraindications_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- æ‰€æ„Ÿã®è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div class="suggestion-comparison" style="margin-bottom: 20px;">
                <div class="suggestion-comparison-header">è¨ˆç”»ä½œæˆæ™‚ã®æ‹…å½“è€…æ‰€æ„Ÿ</div>
                <div class="suggestion-box" style="background-color: #fdfdff;">
                    <div class="value-text">{{ therapist_notes or 'æ‰€æ„Ÿã®å…¥åŠ›ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚' }}</div>
                </div>
            </div>

            <table>
                <tbody>
                    <tr>
                        <td colspan="2" class="font-bold text-center">å¿ƒèº«æ©Ÿèƒ½ãƒ»æ§‹é€  <span style="font-weight:normal;">â€»é–¢é€£ã™ã‚‹é …ç›®ã®ã¿è¨˜è¼‰</span></td>
                    </tr>
                    <tr>
                        <td style="width:50%;">
                            <span class="chk {{ 'checked' if plan.func_consciousness_disorder_chk else 'unchecked' }}">æ„è­˜éšœå®³ (JCSãƒ»GCS
                                <span class="value-text">{{ plan.func_consciousness_disorder_jcs_gcs_txt or ' - ' }}</span>)</span>
                        </td>
                        <td class="{{ 'liked-item' if details_map.get('func_rom_limitation_txt') and details_map.get('func_rom_limitation_txt').liked_model }}">
                            <span class="chk {{ 'checked' if plan.func_rom_limitation_chk else 'unchecked' }}">é–¢ç¯€å¯å‹•åŸŸåˆ¶é™ (<span class="value-text">{{ plan.func_rom_limitation_txt or ' - ' }}</span>)</span>
                            {% if details_map.get('func_rom_limitation_txt') %}
                                {% set detail = details_map.get('func_rom_limitation_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.func_rom_limitation_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.func_rom_limitation_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.func_respiratory_disorder_chk else 'unchecked' }}">å‘¼å¸æ©Ÿèƒ½éšœå®³</span>
                            <div class="sub-item">
                                <div><span class="chk {{ 'checked' if plan.func_respiratory_o2_therapy_chk else 'unchecked' }}">é…¸ç´ ç™‚æ³• (<span class="value-text">{{ plan.func_respiratory_o2_therapy_l_min_txt or '-' }}</span> L/min)</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_respiratory_tracheostomy_chk else 'unchecked' }}">æ°—åˆ‡</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_respiratory_ventilator_chk else 'unchecked' }}">äººå·¥å‘¼å¸å™¨</span></div>
                            </div>
                        </td>
                        <td class="{{ 'liked-item' if details_map.get('func_contracture_deformity_txt') and details_map.get('func_contracture_deformity_txt').liked_model }}">
                            <span class="chk {{ 'checked' if plan.func_contracture_deformity_chk else 'unchecked' }}">æ‹˜ç¸®ãƒ»å¤‰å½¢ (<span class="value-text">{{ plan.func_contracture_deformity_txt or ' - ' }}</span>)</span>
                            {% if details_map.get('func_contracture_deformity_txt') %}
                                {% set detail = details_map.get('func_contracture_deformity_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.func_contracture_deformity_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.func_contracture_deformity_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.func_circulatory_disorder_chk else 'unchecked' }}">å¾ªç’°éšœå®³</span>
                            <div class="sub-item">
                                <div><span class="chk {{ 'checked' if plan.func_circulatory_ef_chk else 'unchecked' }}">EF (<span class="value-text">{{ plan.func_circulatory_ef_val or '-' }}</span> %)</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_circulatory_arrhythmia_chk else 'unchecked' }}">ä¸æ•´è„ˆ (
                                    <span class="radio {{ 'checked' if plan.func_circulatory_arrhythmia_status_slct == 'yes' else 'unchecked' }}">æœ‰</span>
                                    <span class="radio {{ 'checked' if plan.func_circulatory_arrhythmia_status_slct == 'no' else 'unchecked' }}">ç„¡</span>)</span>
                                </div>
                            </div>
                        </td>
                        <td class="{{ 'liked-item' if details_map.get('func_muscle_weakness_txt') and details_map.get('func_muscle_weakness_txt').liked_model }}">
                            <span class="chk {{ 'checked' if plan.func_muscle_weakness_chk else 'unchecked' }}">ç­‹åŠ›ä½ä¸‹ (<span class="value-text">{{ plan.func_muscle_weakness_txt or ' - ' }}</span>)</span>
                            {% if details_map.get('func_muscle_weakness_txt') %}
                                {% set detail = details_map.get('func_muscle_weakness_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.func_muscle_weakness_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.func_muscle_weakness_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td rowspan="2">
                            <span class="chk {{ 'checked' if plan.func_risk_factors_chk else 'unchecked' }}">å±é™ºå› å­</span>
                            <div class="sub-item">
                                <div><span class="chk {{ 'checked' if plan.func_risk_hypertension_chk else 'unchecked' }}">é«˜è¡€åœ§ç—‡</span>
                                <span class="chk {{ 'checked' if plan.func_risk_dyslipidemia_chk else 'unchecked' }}">è„‚è³ªç•°å¸¸ç—‡</span>
                                <span class="chk {{ 'checked' if plan.func_risk_diabetes_chk else 'unchecked' }}">ç³–å°¿ç—…</span>
                                <span class="chk {{ 'checked' if plan.func_risk_smoking_chk else 'unchecked' }}">å–«ç…™</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_risk_obesity_chk else 'unchecked' }}">è‚¥æº€</span>
                                <span class="chk {{ 'checked' if plan.func_risk_hyperuricemia_chk else 'unchecked' }}">é«˜å°¿é…¸è¡€ç—‡</span>
                                <span class="chk {{ 'checked' if plan.func_risk_ckd_chk else 'unchecked' }}">æ…¢æ€§è‚è‡“ç—…</span>
                                <span class="chk {{ 'checked' if plan.func_risk_family_history_chk else 'unchecked' }}">å®¶æ—æ­´</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_risk_angina_chk else 'unchecked' }}">ç‹­å¿ƒç—‡</span>
                                <span class="chk {{ 'checked' if plan.func_risk_omi_chk else 'unchecked' }}">é™³æ—§æ€§å¿ƒç­‹æ¢—å¡</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_risk_other_chk else 'unchecked' }}">ãã®ä»– (<span class="value-text">{{ plan.func_risk_other_txt or '-' }}</span>)</span></div>
                            </div>
                        </td>
                        <td>
                            <span class="chk {{ 'checked' if plan.func_motor_dysfunction_chk else 'unchecked' }}">é‹å‹•æ©Ÿèƒ½éšœå®³</span>
                            <div class="sub-item">
                                <div><span class="chk {{ 'checked' if plan.func_motor_paralysis_chk else 'unchecked' }}">éº»ç—º</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_motor_involuntary_movement_chk else 'unchecked' }}">ä¸éšæ„é‹å‹•</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_motor_ataxia_chk else 'unchecked' }}">é‹å‹•å¤±èª¿</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_motor_parkinsonism_chk else 'unchecked' }}">ï¾Šï¾Ÿï½°ï½·ï¾ï½¿ï¾†ï½½ï¾ï¾‘</span></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="{{ 'liked-item' if details_map.get('func_motor_muscle_tone_abnormality_txt') and details_map.get('func_motor_muscle_tone_abnormality_txt').liked_model }}">
                            <span class="chk {{ 'checked' if plan.func_motor_muscle_tone_abnormality_chk else 'unchecked' }}">ç­‹ç·Šå¼µç•°å¸¸ (<span class="value-text">{{ plan.func_motor_muscle_tone_abnormality_txt or ' - ' }}</span>)</span>
                            {% if details_map.get('func_motor_muscle_tone_abnormality_txt') %}
                                {% set detail = details_map.get('func_motor_muscle_tone_abnormality_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.func_motor_muscle_tone_abnormality_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.func_motor_muscle_tone_abnormality_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td class="{{ 'liked-item' if details_map.get('func_swallowing_disorder_txt') and details_map.get('func_swallowing_disorder_txt').liked_model }}">
                            <span class="chk {{ 'checked' if plan.func_swallowing_disorder_chk else 'unchecked' }}">æ‘‚é£Ÿåš¥ä¸‹éšœå®³ (<span class="value-text">{{ plan.func_swallowing_disorder_txt or ' - ' }}</span>)</span>
                            {% if details_map.get('func_swallowing_disorder_txt') %}
                                {% set detail = details_map.get('func_swallowing_disorder_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.func_swallowing_disorder_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.func_swallowing_disorder_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                        <td>
                            <span class="chk {{ 'checked' if plan.func_sensory_dysfunction_chk else 'unchecked' }}">æ„Ÿè¦šæ©Ÿèƒ½éšœå®³</span>
                            <div class="sub-item">
                                <div><span class="chk {{ 'checked' if plan.func_sensory_hearing_chk else 'unchecked' }}">è´è¦š</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_sensory_vision_chk else 'unchecked' }}">è¦–è¦š</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_sensory_superficial_chk else 'unchecked' }}">è¡¨åœ¨è¦š</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_sensory_deep_chk else 'unchecked' }}">æ·±éƒ¨è¦š</span></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="{{ 'liked-item' if details_map.get('func_nutritional_disorder_txt') and details_map.get('func_nutritional_disorder_txt').liked_model }}">
                            <span class="chk {{ 'checked' if plan.func_nutritional_disorder_chk else 'unchecked' }}">æ „é¤Šéšœå®³ (<span class="value-text">{{ plan.func_nutritional_disorder_txt or ' - ' }}</span>)</span>
                            {% if details_map.get('func_nutritional_disorder_txt') %}
                                {% set detail = details_map.get('func_nutritional_disorder_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.func_nutritional_disorder_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.func_nutritional_disorder_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                        <td>
                            <span class="chk {{ 'checked' if plan.func_speech_disorder_chk else 'unchecked' }}">éŸ³å£°ç™ºè©±éšœå®³</span>
                            <div class="sub-item">
                                <div><span class="chk {{ 'checked' if plan.func_speech_articulation_chk else 'unchecked' }}">æ§‹éŸ³</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_speech_aphasia_chk else 'unchecked' }}">å¤±èª</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_speech_stuttering_chk else 'unchecked' }}">åƒéŸ³</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_speech_other_chk else 'unchecked' }}">ãã®ä»– (<span class="value-text">{{ plan.func_speech_other_txt or '-' }}</span>)</span></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="{{ 'liked-item' if details_map.get('func_excretory_disorder_txt') and details_map.get('func_excretory_disorder_txt').liked_model }}">
                            <span class="chk {{ 'checked' if plan.func_excretory_disorder_chk else 'unchecked' }}">æ’æ³„æ©Ÿèƒ½éšœå®³ (<span class="value-text">{{ plan.func_excretory_disorder_txt or ' - ' }}</span>)</span>
                            {% if details_map.get('func_excretory_disorder_txt') %}
                                {% set detail = details_map.get('func_excretory_disorder_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.func_excretory_disorder_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.func_excretory_disorder_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                        <td>
                            <span class="chk {{ 'checked' if plan.func_higher_brain_dysfunction_chk else 'unchecked' }}">é«˜æ¬¡è„³æ©Ÿèƒ½éšœå®³</span>
                            <div class="sub-item">
                                <div><span class="chk {{ 'checked' if plan.func_higher_brain_memory_chk else 'unchecked' }}">è¨˜æ†¶</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_higher_brain_attention_chk else 'unchecked' }}">æ³¨æ„</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_higher_brain_apraxia_chk else 'unchecked' }}">å¤±è¡Œ</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_higher_brain_agnosia_chk else 'unchecked' }}">å¤±èª</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_higher_brain_executive_chk else 'unchecked' }}">é‚è¡Œ</span></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="{{ 'liked-item' if details_map.get('func_pressure_ulcer_txt') and details_map.get('func_pressure_ulcer_txt').liked_model }}">
                            <span class="chk {{ 'checked' if plan.func_pressure_ulcer_chk else 'unchecked' }}">è¤¥ç˜¡ (<span class="value-text">{{ plan.func_pressure_ulcer_txt or ' - ' }}</span>)</span>
                            {% if details_map.get('func_pressure_ulcer_txt') %}
                                {% set detail = details_map.get('func_pressure_ulcer_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.func_pressure_ulcer_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.func_pressure_ulcer_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                        <td class="{{ 'liked-item' if details_map.get('func_behavioral_psychiatric_disorder_txt') and details_map.get('func_behavioral_psychiatric_disorder_txt').liked_model }}">
                            <span class="chk {{ 'checked' if plan.func_behavioral_psychiatric_disorder_chk else 'unchecked' }}">ç²¾ç¥è¡Œå‹•éšœå®³ (<span class="value-text">{{ plan.func_behavioral_psychiatric_disorder_txt or ' - ' }}</span>)</span>
                            {% if details_map.get('func_behavioral_psychiatric_disorder_txt') %}
                                {% set detail = details_map.get('func_behavioral_psychiatric_disorder_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.func_behavioral_psychiatric_disorder_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.func_behavioral_psychiatric_disorder_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td class="{{ 'liked-item' if details_map.get('func_pain_txt') and details_map.get('func_pain_txt').liked_model }}">
                            <span class="chk {{ 'checked' if plan.func_pain_chk else 'unchecked' }}">ç–¼ç—› (<span class="value-text">{{ plan.func_pain_txt or ' - ' }}</span>)</span>
                            {% if details_map.get('func_pain_txt') %}
                                {% set detail = details_map.get('func_pain_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.func_pain_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.func_pain_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                        <td class="{{ 'liked-item' if details_map.get('func_disorientation_txt') and details_map.get('func_disorientation_txt').liked_model }}">
                            <span class="chk {{ 'checked' if plan.func_disorientation_chk else 'unchecked' }}">è¦‹å½“è­˜éšœå®³ (<span class="value-text">{{ plan.func_disorientation_txt or ' - ' }}</span>)</span>
                            {% if details_map.get('func_disorientation_txt') %}
                                {% set detail = details_map.get('func_disorientation_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.func_disorientation_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.func_disorientation_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.func_other_chk else 'unchecked' }}">ãã®ä»– (<span class="value-text">{{ plan.func_other_txt or ' - ' }}</span>)</span>
                        </td>
                        <td class="{{ 'liked-item' if details_map.get('func_memory_disorder_txt') and details_map.get('func_memory_disorder_txt').liked_model }}">
                            <span class="chk {{ 'checked' if plan.func_memory_disorder_chk else 'unchecked' }}">è¨˜æ†¶éšœå®³ (<span class="value-text">{{ plan.func_memory_disorder_txt or ' - ' }}</span>)</span>
                            {% if details_map.get('func_memory_disorder_txt') %}
                                {% set detail = details_map.get('func_memory_disorder_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.func_memory_disorder_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.func_memory_disorder_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <span class="chk {{ 'checked' if plan.func_developmental_disorder_chk else 'unchecked' }}">ç™ºé”éšœå®³</span>
                            <div class="sub-item">
                                <div><span class="chk {{ 'checked' if plan.func_developmental_asd_chk else 'unchecked' }}">è‡ªé–‰ç—‡ï½½ï¾ï¾Ÿï½¸ï¾„ï¾—ï¾‘ç—‡</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_developmental_ld_chk else 'unchecked' }}">å­¦ç¿’éšœå®³</span></div>
                                <div><span class="chk {{ 'checked' if plan.func_developmental_adhd_chk else 'unchecked' }}">æ³¨æ„æ¬ é™¥å¤šå‹•æ€§éšœå®³</span></div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>

            {# FIMé‹å‹•é …ç›® #}
            {% set fim_motor_start_items = [
                plan.adl_eating_fim_start_val, plan.adl_grooming_fim_start_val, plan.adl_bathing_fim_start_val,
                plan.adl_dressing_upper_fim_start_val, plan.adl_dressing_lower_fim_start_val, plan.adl_toileting_fim_start_val,
                plan.adl_bladder_management_fim_start_val, plan.adl_bowel_management_fim_start_val,
                plan.adl_transfer_bed_chair_wc_fim_start_val, plan.adl_transfer_toilet_fim_start_val,
                plan.adl_transfer_tub_shower_fim_start_val, plan.adl_locomotion_walk_walkingAids_wc_fim_start_val,
                plan.adl_locomotion_stairs_fim_start_val
            ] %}
            {% set fim_motor_current_items = [
                plan.adl_eating_fim_current_val, plan.adl_grooming_fim_current_val, plan.adl_bathing_fim_current_val,
                plan.adl_dressing_upper_fim_current_val, plan.adl_dressing_lower_fim_current_val, plan.adl_toileting_fim_current_val,
                plan.adl_bladder_management_fim_current_val, plan.adl_bowel_management_fim_current_val,
                plan.adl_transfer_bed_chair_wc_fim_current_val, plan.adl_transfer_toilet_fim_current_val,
                plan.adl_transfer_tub_shower_fim_current_val, plan.adl_locomotion_walk_walkingAids_wc_fim_current_val,
                plan.adl_locomotion_stairs_fim_current_val
            ] %}

            {# FIMèªçŸ¥é …ç›® #}
            {% set fim_cognitive_start_items = [
                plan.adl_comprehension_fim_start_val, plan.adl_expression_fim_start_val,
                plan.adl_social_interaction_fim_start_val, plan.adl_problem_solving_fim_start_val,
                plan.adl_memory_fim_start_val
            ] %}
            {% set fim_cognitive_current_items = [
                plan.adl_comprehension_fim_current_val, plan.adl_expression_fim_current_val,
                plan.adl_social_interaction_fim_current_val, plan.adl_problem_solving_fim_current_val,
                plan.adl_memory_fim_current_val
            ] %}

            {# BIé …ç›® #}
            {% set bi_start_items = [
                plan.adl_eating_bi_start_val, plan.adl_grooming_bi_start_val, plan.adl_bathing_bi_start_val,
                plan.adl_dressing_bi_start_val, plan.adl_toileting_bi_start_val, plan.adl_bladder_management_bi_start_val,
                plan.adl_bowel_management_bi_start_val, plan.adl_transfer_bi_start_val, plan.adl_locomotion_walk_walkingAids_wc_bi_start_val,
                plan.adl_locomotion_stairs_bi_start_val
            ] %}
            {% set bi_current_items = [
                plan.adl_eating_bi_current_val, plan.adl_grooming_bi_current_val, plan.adl_bathing_bi_current_val,
                plan.adl_dressing_bi_current_val, plan.adl_toileting_bi_current_val, plan.adl_bladder_management_bi_current_val,
                plan.adl_bowel_management_bi_current_val, plan.adl_transfer_bi_current_val, plan.adl_locomotion_walk_walkingAids_wc_bi_current_val,
                plan.adl_locomotion_stairs_bi_current_val
            ] %}

            {# è¨ˆç®— #}
            {% set fim_motor_start_total = fim_motor_start_items | map('int', default=0) | sum %}
            {% set fim_motor_current_total = fim_motor_current_items | map('int', default=0) | sum %}
            {% set fim_cognitive_start_total = fim_cognitive_start_items | map('int', default=0) | sum %}
            {% set fim_cognitive_current_total = fim_cognitive_current_items | map('int', default=0) | sum %}
            {% set bi_start_total = bi_start_items | map('int', default=0) | sum %}
            {% set bi_current_total = bi_current_items | map('int', default=0) | sum %}

            {% set fim_grand_start_total = fim_motor_start_total + fim_cognitive_start_total %}
            {% set fim_grand_current_total = fim_motor_current_total + fim_cognitive_current_total %}

            <table>
                <thead>
                    <tr>
                        <th colspan="5">æ—¥å¸¸ç”Ÿæ´»æ´»å‹•ï¼ˆå‹•ä½œï¼‰ ï¼ˆå®Ÿè¡ŒçŠ¶æ³ï¼‰ã€€â€»BIã¾ãŸã¯FIMã®ã„ãšã‚Œã‹ã‚’å¿…ãšè¨˜è¼‰</th>
                        <th rowspan="2">ä½¿ç”¨ç”¨å…·åŠã³<br>ä»‹åŠ©å†…å®¹ç­‰</th>
                    </tr>
                    <tr>
                        <th colspan="2">é …ç›®</th>
                        <th colspan="2">å¾—ç‚¹ã€€ã€€é–‹å§‹æ™‚â†’ç¾åœ¨</th>
                        <th></th>
                    </tr>
                    <tr>
                        <th colspan="3"></th>
                        <th>FIM</th>
                        <th>BI</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th rowspan="13" class="vertical-rl">é‹å‹•</th>
                        <th rowspan="6">ã‚»ãƒ«ãƒ•ã‚±ã‚¢</th>
                        <td>é£Ÿäº‹</td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_eating_fim_start_val or '-' }} â†’ {{ plan.adl_eating_fim_current_val or '-' }}</span></td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_eating_bi_start_val or '-' }} â†’ {{ plan.adl_eating_bi_current_val or '-' }}</span></td>
                        <td rowspan="20" style="width: 450px;" class="{{ 'liked-item' if details_map.get('adl_equipment_and_assistance_details_txt') and details_map.get('adl_equipment_and_assistance_details_txt').liked_model }}">
                            <div class="value-text">{{ plan.adl_equipment_and_assistance_details_txt or '' }}</div>
                            {% if details_map.get('adl_equipment_and_assistance_details_txt') %}
                                {% set detail = details_map.get('adl_equipment_and_assistance_details_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.adl_equipment_and_assistance_details_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.adl_equipment_and_assistance_details_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>æ•´å®¹</td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_grooming_fim_start_val or '-' }} â†’ {{ plan.adl_grooming_fim_current_val or '-' }}</span></td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_grooming_bi_start_val or '-' }} â†’ {{ plan.adl_grooming_bi_current_val or '-' }}</span></td>
                    </tr>
                    <tr>
                        <td>æ¸…æ‹­ãƒ»å…¥æµ´</td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_bathing_fim_start_val or '-' }} â†’ {{ plan.adl_bathing_fim_current_val or '-' }}</span></td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_bathing_bi_start_val or '-' }} â†’ {{ plan.adl_bathing_bi_current_val or '-' }}</span></td>
                    </tr>
                    <tr>
                        <td>æ›´è¡£ï¼ˆä¸ŠåŠèº«ï¼‰</td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_dressing_upper_fim_start_val or '-' }} â†’ {{ plan.adl_dressing_upper_fim_current_val or '-' }}</span></td>
                        <td rowspan="2" class="text-center"><span class="value-text">{{ plan.adl_dressing_bi_start_val or '-' }} â†’ {{ plan.adl_dressing_bi_current_val or '-' }}</span></td>
                    </tr>
                    <tr>
                        <td>æ›´è¡£ï¼ˆä¸‹åŠèº«ï¼‰</td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_dressing_lower_fim_start_val or '-' }} â†’ {{ plan.adl_dressing_lower_fim_current_val or '-' }}</span></td>
                    </tr>
                    <tr>
                        <td>ãƒˆã‚¤ãƒ¬</td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_toileting_fim_start_val or '-' }} â†’ {{ plan.adl_toileting_fim_current_val or '-' }}</span></td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_toileting_bi_start_val or '-' }} â†’ {{ plan.adl_toileting_bi_current_val or '-' }}</span></td>
                    </tr>
                    <tr>
                        <th rowspan="2">æ’æ³„</th>
                        <td>æ’å°¿ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_bladder_management_fim_start_val or '-' }} â†’ {{ plan.adl_bladder_management_fim_current_val or '-' }}</span></td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_bladder_management_bi_start_val or '-' }} â†’ {{ plan.adl_bladder_management_bi_current_val or '-' }}</span></td>
                    </tr>
                    <tr>
                        <td>æ’ä¾¿ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_bowel_management_fim_start_val or '-' }} â†’ {{ plan.adl_bowel_management_fim_current_val or '-' }}</span></td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_bowel_management_bi_start_val or '-' }} â†’ {{ plan.adl_bowel_management_bi_current_val or '-' }}</span></td>
                    </tr>
                    <tr>
                        <th rowspan="3">ç§»ä¹—</th>
                        <td>ãƒ™ãƒƒãƒ‰ã€æ¤…å­ã€è»Šæ¤…å­</td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_transfer_bed_chair_wc_fim_start_val or '-' }} â†’ {{ plan.adl_transfer_bed_chair_wc_fim_current_val or '-' }}</span></td>
                        <td rowspan="3" class="text-center"><span class="value-text">{{ plan.adl_transfer_bi_start_val or '-' }} â†’ {{ plan.adl_transfer_bi_current_val or '-' }}</span></td>
                    </tr>
                    <tr>
                        <td>ãƒˆã‚¤ãƒ¬</td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_transfer_toilet_fim_start_val or '-' }} â†’ {{ plan.adl_transfer_toilet_fim_current_val or '-' }}</span></td>
                    </tr>
                    <tr>
                        <td>æµ´æ§½ãƒ»ã‚·ãƒ£ãƒ¯ãƒ¼</td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_transfer_tub_shower_fim_start_val or '-' }} â†’ {{ plan.adl_transfer_tub_shower_fim_current_val or '-' }}</span></td>
                    </tr>
                    <tr>
                        <th rowspan="2">ç§»å‹•</th>
                        <td>æ­©è¡Œãƒ»è»Šæ¤…å­</td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_locomotion_walk_walkingAids_wc_fim_start_val or '-' }} â†’ {{ plan.adl_locomotion_walk_walkingAids_wc_fim_current_val or '-' }}</span></td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_locomotion_walk_walkingAids_wc_bi_start_val or '-' }} â†’ {{ plan.adl_locomotion_walk_walkingAids_wc_bi_current_val or '-' }}</span></td>
                    </tr>
                    <tr>
                        <td>éšæ®µ</td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_locomotion_stairs_fim_start_val or '-' }} â†’ {{ plan.adl_locomotion_stairs_fim_current_val or '-' }}</span></td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_locomotion_stairs_bi_start_val or '-' }} â†’ {{ plan.adl_locomotion_stairs_bi_current_val or '-' }}</span></td>
                    </tr>
                    <tr>
                        <td colspan="3" class="text-center">å°è¨ˆ</td>
                        <td class="text-center"><span class="value-text">{{ fim_motor_start_total }} â†’ {{ fim_motor_current_total }}</span></td>
                        <td class="text-center"><span class="value-text">{{ bi_start_total }} â†’ {{ bi_current_total }}</span></td>
                    </tr>
                    <tr>
                        <th rowspan="5" class="vertical-rl">èªçŸ¥</th>
                        <th rowspan="2">ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³</th>
                        <td>ç†è§£</td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_comprehension_fim_start_val or '-' }} â†’ {{ plan.adl_comprehension_fim_current_val or '-' }}</span></td>
                        <td rowspan="5"></td>
                    </tr>
                    <tr>
                        <td>è¡¨å‡º</td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_expression_fim_start_val or '-' }} â†’ {{ plan.adl_expression_fim_current_val or '-' }}</span></td>
                    </tr>
                    <tr>
                        <th rowspan="3">ç¤¾ä¼šèªè­˜</th>
                        <td>ç¤¾ä¼šçš„äº¤æµ</td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_social_interaction_fim_start_val or '-' }} â†’ {{ plan.adl_social_interaction_fim_current_val or '-' }}</span></td>
                    </tr>
                    <tr>
                        <td>å•é¡Œè§£æ±º</td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_problem_solving_fim_start_val or '-' }} â†’ {{ plan.adl_problem_solving_fim_current_val or '-' }}</span></td>
                    </tr>
                    <tr>
                        <td>è¨˜æ†¶</td>
                        <td class="text-center"><span class="value-text">{{ plan.adl_memory_fim_start_val or '-' }} â†’ {{ plan.adl_memory_fim_current_val or '-' }}</span></td>
                    </tr>
                    <tr>
                        <td colspan="3" class="text-center">å°è¨ˆ</td>
                        <td class="text-center"><span class="value-text">{{ fim_cognitive_start_total }} â†’ {{ fim_cognitive_current_total }}</span></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td colspan="3" class="text-center font-bold">åˆè¨ˆ</td>
                        <td class="text-center"><span class="value-text">{{ fim_grand_start_total }} â†’ {{ fim_grand_current_total }}</span></td>
                        <td class="text-center"><span class="value-text">{{ bi_start_total }} â†’ {{ bi_current_total }}</span></td>
                    </tr>
                </tbody>
            </table>

            <!-- æ „é¤Š -->
            <table>
                <thead>
                    <tr>
                        <th colspan="4">æ „é¤Šï¼ˆâ€»å›å¾©æœŸãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç—…æ£Ÿå…¥é™¢æ–™ï¼‘ã‚’ç®—å®šã™ã‚‹å ´åˆã¯å¿…ãšè¨˜å…¥ï¼‰</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="4">
                            <b>åŸºç¤æƒ…å ±</b>ã€€
                            <span class="chk {{ 'checked' if plan.nutrition_height_chk else 'unchecked' }}">èº«é•·: (<span class="value-text">{{ plan.nutrition_height_val or '-' }}</span>) cm</span>
                            <span class="chk {{ 'checked' if plan.nutrition_weight_chk else 'unchecked' }}">ä½“é‡: (<span class="value-text">{{ plan.nutrition_weight_val or '-' }}</span>) kg</span>
                            <span class="chk {{ 'checked' if plan.nutrition_bmi_chk else 'unchecked' }}">BMI: (<span class="value-text">{{ plan.nutrition_bmi_val or '-' }}</span>) kg/ã¡</span>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="4">
                            <b>æ „é¤Šè£œçµ¦æ–¹æ³•ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</b>
                            <span class="chk {{ 'checked' if plan.nutrition_method_oral_chk else 'unchecked' }}">çµŒå£:
                                (<span class="chk {{ 'checked' if plan.nutrition_method_oral_meal_chk else 'unchecked' }}">é£Ÿäº‹</span>
                                 <span class="chk {{ 'checked' if plan.nutrition_method_oral_supplement_chk else 'unchecked' }}">è£œåŠ©é£Ÿå“</span>)
                            </span>
                            <span class="chk {{ 'checked' if plan.nutrition_method_tube_chk else 'unchecked' }}">çµŒç®¡æ „é¤Š</span>
                            <span class="chk {{ 'checked' if plan.nutrition_method_iv_chk else 'unchecked' }}">é™è„ˆæ „é¤Š:
                                (<span class="chk {{ 'checked' if plan.nutrition_method_iv_peripheral_chk else 'unchecked' }}">æœ«æ¢¢</span>
                                 <span class="chk {{ 'checked' if plan.nutrition_method_iv_central_chk else 'unchecked' }}">ä¸­å¿ƒ</span>)
                            </span>
                            <span class="chk {{ 'checked' if plan.nutrition_method_peg_chk else 'unchecked' }}">èƒƒã‚ã†</span>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="4">
                            <b>åš¥ä¸‹èª¿æ•´é£Ÿã®å¿…è¦æ€§ï¼š</b>
                            (
                            <span class="radio {{ 'checked' if plan.nutrition_swallowing_diet_slct == 'None' else 'unchecked' }}">ç„¡</span>
                            <span class="radio {{ 'checked' if plan.nutrition_swallowing_diet_slct == 'True' else 'unchecked' }}">æœ‰</span>
                            :ï¼ˆå­¦ä¼šåˆ†é¡ã‚³ãƒ¼ãƒ‰ <span class="value-text">{{ plan.nutrition_swallowing_diet_code_txt or '-' }}</span>ï¼‰)
                        </td>
                    </tr>
                    <tr>
                        <td colspan="4">
                            <b>æ „é¤ŠçŠ¶æ…‹ã®è©•ä¾¡ï¼š</b>
                            <span class="radio {{ 'checked' if plan.nutrition_status_assessment_slct == 'no_problem' else 'unchecked' }}">å•é¡Œãªã—</span>
                            <span class="radio {{ 'checked' if plan.nutrition_status_assessment_slct == 'malnutrition' else 'unchecked' }}">ä½æ „é¤Š</span>
                            <span class="radio {{ 'checked' if plan.nutrition_status_assessment_slct == 'malnutrition_risk' else 'unchecked' }}">ä½æ „é¤Šãƒªã‚¹ã‚¯</span>
                            <span class="radio {{ 'checked' if plan.nutrition_status_assessment_slct == 'overnutrition' else 'unchecked' }}">éæ „é¤Š</span>
                            <span class="radio {{ 'checked' if plan.nutrition_status_assessment_slct == 'other' else 'unchecked' }}">ãã®ä»–</span>
                            (<span class="value-text">{{ plan.nutrition_status_assessment_other_txt or '-' }}</span>)
                        </td>
                    </tr>
                    <tr>
                        <td colspan="4" class="text-left"><b>ã€ä¸Šè¨˜ã§ã€Œå•é¡Œãªã—ã€ä»¥å¤–ã«è©²å½“ã—ãŸå ´åˆã«è¨˜è¼‰ã€‘</b></td>
                    </tr>
                    <tr>
                        <td>å¿…è¦æ „é¤Šé‡</td>
                        <td>ç†±é‡ï¼š(<span class="value-text">{{ plan.nutrition_required_energy_val or '-' }}</span>) kcal</td>
                        <td colspan="2">ã‚¿ãƒ³ãƒ‘ã‚¯è³ªé‡ (<span class="value-text">{{ plan.nutrition_required_protein_val or '-' }}</span>) g</td>
                    </tr>
                    <tr>
                        <td>ç·æ‘‚å–æ „é¤Šé‡</td>
                        <td>ç†±é‡ï¼š(<span class="value-text">{{ plan.nutrition_total_intake_energy_val or '-' }}</span>) kcal</td>
                        <td colspan="2">ã‚¿ãƒ³ãƒ‘ã‚¯è³ªé‡ (<span class="value-text">{{ plan.nutrition_total_intake_protein_val or '-' }}</span>) g</td>
                    </tr>
                    <tr>
                        <td colspan="4" class="notes">ï¼Šï¼‘ï¼šèº«é•·æ¸¬å®šãŒå›°é›£ãªå ´åˆã¯çœç•¥å¯ ï¼Šï¼’ï¼šå…¥é™¢ç›´å¾Œç­‰ã§ä¸æ˜ãªå ´åˆã¯ç·æä¾›æ „é¤Šé‡ã§ã‚‚å¯</td>
                    </tr>
                </tbody>
            </table>

            <!-- ç¤¾ä¼šä¿éšœã‚µãƒ¼ãƒ“ã‚¹ -->
            <table>
                <thead>
                    <tr>
                        <th colspan="5">ç¤¾ä¼šä¿éšœã‚µãƒ¼ãƒ“ã‚¹ã®ç”³è«‹çŠ¶æ³ã€€â€»è©²å½“ã‚ã‚‹ã‚‚ã®ã®ã¿</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.social_care_level_status_chk else 'unchecked' }}">è¦ä»‹è­·çŠ¶æ…‹åŒºåˆ†ç­‰</span>
                            <div class="sub-item">
                                <span class="chk {{ 'checked' if plan.social_care_level_applying_chk else 'unchecked' }}">ç”³è«‹ä¸­</span><br>
                                <span class="chk {{ 'checked' if plan.social_care_level_support_chk else 'unchecked' }}">è¦æ”¯æ´çŠ¶æ…‹åŒºåˆ†</span>
                                (
                                <span class="radio {{ 'checked' if plan.social_care_level_support_num1_slct else 'unchecked' }}">1</span>
                                <span class="radio {{ 'checked' if plan.social_care_level_support_num2_slct else 'unchecked' }}">2</span>
                                )<br>
                                <span class="chk {{ 'checked' if plan.social_care_level_care_slct else 'unchecked' }}">è¦ä»‹è­·çŠ¶æ…‹åŒºåˆ†</span>
                                (
                                <span class="radio {{ 'checked' if plan.social_care_level_care_num1_slct else 'unchecked' }}">1</span>
                                <span class="radio {{ 'checked' if plan.social_care_level_care_num2_slct else 'unchecked' }}">2</span>
                                <span class="radio {{ 'checked' if plan.social_care_level_care_num3_slct else 'unchecked' }}">3</span>
                                <span class="radio {{ 'checked' if plan.social_care_level_care_num4_slct else 'unchecked' }}">4</span>
                                <span class="radio {{ 'checked' if plan.social_care_level_care_num5_slct else 'unchecked' }}">5</span>
                                )
                            </div>
                        </td>
                        <td>
                            <span class="chk {{ 'checked' if plan.social_disability_certificate_physical_chk else 'unchecked' }}">èº«ä½“éšœå®³è€…æ‰‹å¸³</span>
                            <div class="sub-item">
                                ç¨®åˆ¥: <span class="value-text">{{ plan.social_disability_certificate_physical_type_txt or '-' }}</span><br>
                                ç­‰ç´š: <span class="value-text">{{ plan.social_disability_certificate_physical_rank_val or '-' }} ç´š</span>
                            </div>
                        </td>
                        <td>
                            <span class="chk {{ 'checked' if plan.social_disability_certificate_mental_chk else 'unchecked' }}">ç²¾ç¥éšœå®³è€…<br>ä¿å¥ç¦ç¥‰æ‰‹å¸³</span>
                            <div class="sub-item">
                                ç­‰ç´š: <span class="value-text">{{ plan.social_disability_certificate_mental_rank_val or '-' }} ç´š</span>
                            </div>
                        </td>
                        <td>
                            <span class="chk {{ 'checked' if plan.social_disability_certificate_intellectual_chk else 'unchecked' }}">ç™‚è‚²æ‰‹å¸³<br>æ„›è­·æ‰‹å¸³</span>
                            <div class="sub-item">
                                ç­‰ç´š: <span class="value-text">{{ plan.social_disability_certificate_intellectual_grade_txt or '-' }}</span>
                            </div>
                        </td>
                        <td>
                            <span class="chk {{ 'checked' if plan.social_disability_certificate_other_chk else 'unchecked' }}">ãã®ä»– (é›£ç—…ç­‰)</span>
                            <div class="sub-item">
                                <span class="value-text">{{ plan.social_disability_certificate_other_txt or '-' }}</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- ç›®æ¨™ãƒ»æ–¹é‡ -->
            <table>
                <tbody>
                    <tr>
                        <td style="width:50%; height: 150px;" class="{{ 'liked-item' if details_map.get('goals_1_month_txt') and details_map.get('goals_1_month_txt').liked_model }}">
                            <b>ç›®æ¨™ï¼ˆï¼‘ãƒ¶æœˆï¼‰</b>
                            <div class="value-text">{{ plan.goals_1_month_txt or '' }}</div>
                            {% if details_map.get('goals_1_month_txt') %}
                                {% set detail = details_map.get('goals_1_month_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.goals_1_month_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.goals_1_month_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                        <td style="height: 150px;" class="{{ 'liked-item' if details_map.get('goals_at_discharge_txt') and details_map.get('goals_at_discharge_txt').liked_model }}">
                            <b>ç›®æ¨™ï¼ˆçµ‚äº†æ™‚ï¼‰</b>
                            <div class="sub-item">
                                <span class="chk {{ 'checked' if plan.goals_planned_hospitalization_period_chk else 'unchecked' }}">äºˆç´„å…¥é™¢æœŸé–“
                                    (<span class="value-text">{{ plan.goals_planned_hospitalization_period_txt or '-' }}</span>)
                                </span><br>
                                <span class="chk {{ 'checked' if plan.goals_discharge_destination_chk else 'unchecked' }}">é€€é™¢å…ˆ
                                    (<span class="value-text">{{ plan.goals_discharge_destination_txt or '-' }}</span>)
                                </span><br>
                                <span class="chk {{ 'checked' if plan.goals_long_term_care_needed_chk else 'unchecked' }}">é•·æœŸçš„ãƒ»ç¶™ç¶šçš„ã«ã‚±ã‚¢ãŒå¿…è¦</span>
                            </div>
                            <div class="value-text">{{ plan.goals_at_discharge_txt or '' }}</div>
                            {% if details_map.get('goals_at_discharge_txt') %}
                                {% set detail = details_map.get('goals_at_discharge_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.goals_at_discharge_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.goals_at_discharge_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td style="height: 150px;" class="{{ 'liked-item' if details_map.get('policy_treatment_txt') and details_map.get('policy_treatment_txt').liked_model }}">
                            <b>æ²»ç™‚æ–¹é‡ï¼ˆãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿæ–½æ–¹é‡ï¼‰</b>
                            <div class="value-text">{{ plan.policy_treatment_txt or '' }}</div>
                            {% if details_map.get('policy_treatment_txt') %}
                                {% set detail = details_map.get('policy_treatment_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.policy_treatment_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.policy_treatment_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                        <td style="height: 150px;" class="{{ 'liked-item' if details_map.get('policy_content_txt') and details_map.get('policy_content_txt').liked_model }}">
                            <b>æ²»ç™‚å†…å®¹ï¼ˆãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿæ–½å†…å®¹ï¼‰</b>
                            <div class="value-text">{{ plan.policy_content_txt or '' }}</div>
                            {% if details_map.get('policy_content_txt') %}
                                {% set detail = details_map.get('policy_content_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.policy_content_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.policy_content_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- ç½²å -->
            <table>
                <tbody>
                    <tr>
                        <td>ãƒªãƒæ‹…å½“åŒ»</td>
                        <td><span class="value-text">{{ plan.signature_rehab_doctor_txt or '-' }}</span></td>
                        <td>ä¸»æ²»åŒ»</td>
                        <td><span class="value-text">{{ plan.signature_primary_doctor_txt or '-' }}</span></td>
                        <td colspan="2" rowspan="4">
                            èª¬æ˜ã‚’å—ã‘ãŸäººï¼š
                            <span class="value-text">{{ plan.signature_explained_to_txt or '-' }}</span><br><br>
                            èª¬æ˜æ—¥ï¼š<span class="value-text">{{ plan.signature_explanation_date.strftime('%Y-%m-%d') if plan.signature_explanation_date else '-' }}</span><br><br><br>
                            ç½²å<br>
                        </td>
                    </tr>
                    <tr>
                        <td>ç†å­¦ç™‚æ³•å£«</td>
                        <td style="width: 150px;"><span class="value-text">{{ plan.signature_pt_txt or '-' }}</span></td>
                        <td>ä½œæ¥­ç™‚æ³•å£«</td>
                        <td style="width: 150px;"><span class="value-text">{{ plan.signature_ot_txt or '-' }}</span></td>
                    </tr>
                    <tr>
                        <td>è¨€èªè´è¦šå£«</td>
                        <td><span class="value-text">{{ plan.signature_st_txt or '-' }}</span></td>
                        <td>çœ‹è­·å¸«</td>
                        <td><span class="value-text">{{ plan.signature_nurse_txt or '-' }}</span></td>
                    </tr>
                    <tr>
                        <td>ç®¡ç†æ „é¤Šå£«</td>
                        <td><span class="value-text">{{ plan.signature_dietitian_txt or '-' }}</span></td>
                        <td>ç¤¾ä¼šç¦ç¥‰å£«</td>
                        <td><span class="value-text">{{ plan.signature_social_worker_txt or '-' }}</span></td>
                    </tr>
                    <tr>
                        <td colspan="6"> èª¬æ˜è€…ç½²å<br><br> <span class="value-text">{{ plan.signature_explainer_txt or '-' }}</span></td>
                    </tr>
                </tbody>
            </table>

            <!-- 2æšç›®ã®å†…å®¹ -->
            <table>
                <thead>
                    <tr>
                        <th colspan="2" style="width: 60%;">ç›®æ¨™ã€€â€»è©²å½“ã™ã‚‹é …ç›®ã®ã¿è¨˜è¼‰ã™ã‚‹</th>
                        <th style="width: 40%;">å…·ä½“çš„ãªå¯¾å¿œæ–¹é‡ã€€â€»å¿…è¦ãªå ´åˆè¨˜è¼‰ã™ã‚‹</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th rowspan="6" class="vertical-rl">å‚åŠ </th>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_p_residence_chk else 'unchecked' }}">ä½å±…å ´æ‰€</span>
                            <div class="sub-item">
                                <div><span class="radio {{ 'checked' if plan.goal_p_residence_slct == 'home_detached' else 'unchecked' }}">è‡ªå®…(æˆ¸å»º)</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_p_residence_slct == 'home_apartment' else 'unchecked' }}">è‡ªå®…(ãƒãƒ³ã‚·ãƒ§ãƒ³)</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_p_residence_slct == 'facility' else 'unchecked' }}">æ–½è¨­</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_p_residence_slct == 'other' else 'unchecked' }}">ãã®ä»–</span> (<span class="value-text">{{ plan.goal_p_residence_other_txt or '-' }}</span>)</div>
                            </div>
                        </td>
                        <td rowspan="6" class="{{ 'liked-item' if details_map.get('goal_p_action_plan_txt') and details_map.get('goal_p_action_plan_txt').liked_model }}">
                            <div class="value-text">{{ plan.goal_p_action_plan_txt or '' }}</div>
                            {% if details_map.get('goal_p_action_plan_txt') %}
                                {% set detail = details_map.get('goal_p_action_plan_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.goal_p_action_plan_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.goal_p_action_plan_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_p_return_to_work_chk else 'unchecked' }}">å¾©è·</span>
                            <div class="sub-item">
                                <div><span class="radio {{ 'checked' if plan.goal_p_return_to_work_status_slct == 'current_job' else 'unchecked' }}">ç¾è·å¾©å¸°</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_p_return_to_work_status_slct == 'reassignment' else 'unchecked' }}">é…ç½®è»¢æ›</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_p_return_to_work_status_slct == 'new_job' else 'unchecked' }}">è»¢è·</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_p_return_to_work_status_slct == 'not_possible' else 'unchecked' }}">ä¸å¯</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_p_return_to_work_status_slct == 'other' else 'unchecked' }}">ãã®ä»–</span> (<span class="value-text">{{ plan.goal_p_return_to_work_status_other_txt or '-' }}</span>)</div>
                                <div><span class="chk {{ 'checked' if plan.goal_p_return_to_work_commute_change_chk else 'unchecked' }}">é€šå‹¤æ–¹æ³•ã®å¤‰æ›´</span></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_p_schooling_chk else 'unchecked' }}">å°±å­¦ãƒ»å¾©å­¦ãƒ»é€²å­¦</span>
                            <div class="sub-item">
                                <div><span class="radio {{ 'checked' if plan.goal_p_schooling_status_possible_chk else 'unchecked' }}">å¯èƒ½</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_p_schooling_status_needs_consideration_chk else 'unchecked' }}">å°±å­¦ã«è¦é…æ…®</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_p_schooling_status_change_course_chk else 'unchecked' }}">è»¢æ ¡</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_p_schooling_status_not_possible_chk else 'unchecked' }}">ä¸å¯</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_p_schooling_status_other_chk else 'unchecked' }}">ãã®ä»–</span> (<span class="value-text">{{ plan.goal_p_schooling_status_other_txt or '-' }}</span>)</div>
                                <br>
                                <div>ç™‚è‚²ãƒ»é€šå­¦å…ˆ (<span class="value-text">{{ plan.goal_p_schooling_destination_txt or '-' }}</span>)</div>
                                <div>é€šå­¦æ–¹æ³•ã®å¤‰æ›´ (<span class="value-text">{{ plan.goal_p_schooling_commute_change_txt or '-' }}</span>)</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><span class="chk {{ 'checked' if plan.goal_p_household_role_chk else 'unchecked' }}">å®¶åº­å†…å½¹å‰²</span> (<span class="value-text">{{ plan.goal_p_household_role_txt or '-' }}</span>)</td>
                    </tr>
                    <tr>
                        <td><span class="chk {{ 'checked' if plan.goal_p_social_activity_chk else 'unchecked' }}">ç¤¾ä¼šæ´»å‹•</span> (<span class="value-text">{{ plan.goal_p_social_activity_txt or '-' }}</span>)</td>
                    </tr>
                    <tr>
                        <td><span class="chk {{ 'checked' if plan.goal_p_hobby_chk else 'unchecked' }}">è¶£å‘³</span> (<span class="value-text">{{ plan.goal_p_hobby_txt or '-' }}</span>)</td>
                    </tr>
                    <tr>
                        <th rowspan="14" class="vertical-rl">æ´»å‹•</th>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_a_bed_mobility_chk else 'unchecked' }}">åºŠä¸Šç§»å‹• (å¯è¿”ã‚Šã€ãšã‚Šé€™ã„ç§»å‹•ã€å››ã¤é€™ã„ç§»å‹•ãªã©)</span>
                            <div class="sub-item">
                                <div><span class="radio {{ 'checked' if plan.goal_a_bed_mobility_independent_chk else 'unchecked' }}">è‡ªç«‹</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_bed_mobility_assistance_chk else 'unchecked' }}">ä»‹åŠ©</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_bed_mobility_not_performed_chk else 'unchecked' }}">éå®Ÿæ–½</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_a_bed_mobility_equipment_chk else 'unchecked' }}">è£…å…·ãƒ»æ–ç­‰</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_a_bed_mobility_environment_setup_chk else 'unchecked' }}">ç’°å¢ƒè¨­å®š</span></div>
                            </div>
                        </td>
                        <td rowspan="14" class="{{ 'liked-item' if details_map.get('goal_a_action_plan_txt') and details_map.get('goal_a_action_plan_txt').liked_model }}">
                            <div class="value-text">{{ plan.goal_a_action_plan_txt or '' }}</div>
                            {% if details_map.get('goal_a_action_plan_txt') %}
                                {% set detail = details_map.get('goal_a_action_plan_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.goal_a_action_plan_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.goal_a_action_plan_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_a_indoor_mobility_chk else 'unchecked' }}">å±‹å†…ç§»å‹•</span>
                            <div class="sub-item">
                                <div><span class="radio {{ 'checked' if plan.goal_a_indoor_mobility_independent_chk else 'unchecked' }}">è‡ªç«‹</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_indoor_mobility_assistance_chk else 'unchecked' }}">ä»‹åŠ©</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_indoor_mobility_not_performed_chk else 'unchecked' }}">éå®Ÿæ–½</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_a_indoor_mobility_equipment_chk else 'unchecked' }}">è£…å…·ãƒ»æ–ãƒ»è»Šæ¤…å­ç­‰ (<span class="value-text">{{ plan.goal_a_indoor_mobility_equipment_txt or '-' }}</span>)</span></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_a_outdoor_mobility_chk else 'unchecked' }}">å±‹å¤–ç§»å‹•</span>
                            <div class="sub-item">
                                <div><span class="radio {{ 'checked' if plan.goal_a_outdoor_mobility_independent_chk else 'unchecked' }}">è‡ªç«‹</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_outdoor_mobility_assistance_chk else 'unchecked' }}">ä»‹åŠ©</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_outdoor_mobility_not_performed_chk else 'unchecked' }}">éå®Ÿæ–½</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_a_outdoor_mobility_equipment_chk else 'unchecked' }}">è£…å…·ãƒ»æ–ãƒ»è»Šæ¤…å­ç­‰ (<span class="value-text">{{ plan.goal_a_outdoor_mobility_equipment_txt or '-' }}</span>)</span></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_a_driving_chk else 'unchecked' }}">è‡ªå‹•è»Šé‹è»¢</span>
                            <div class="sub-item">
                                <div><span class="radio {{ 'checked' if plan.goal_a_driving_independent_chk else 'unchecked' }}">è‡ªç«‹</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_driving_assistance_chk else 'unchecked' }}">ä»‹åŠ©</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_driving_not_performed_chk else 'unchecked' }}">éå®Ÿæ–½</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_a_driving_modification_chk else 'unchecked' }}">æ”¹é€  (<span class="value-text">{{ plan.goal_a_driving_modification_txt or '-' }}</span>)</span></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_a_public_transport_chk else 'unchecked' }}">å…¬å…±äº¤é€šæ©Ÿé–¢åˆ©ç”¨</span>
                            <div class="sub-item">
                                <div><span class="radio {{ 'checked' if plan.goal_a_public_transport_independent_chk else 'unchecked' }}">è‡ªç«‹</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_public_transport_assistance_chk else 'unchecked' }}">ä»‹åŠ©</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_public_transport_not_performed_chk else 'unchecked' }}">éå®Ÿæ–½</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_a_public_transport_type_chk else 'unchecked' }}">ç¨®é¡ (<span class="value-text">{{ plan.goal_a_public_transport_type_txt or '-' }}</span>)</span></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_a_toileting_chk else 'unchecked' }}">æ’æ³„ (ç§»ä¹—ä»¥å¤–)</span>
                            <div class="sub-item">
                                <div><span class="radio {{ 'checked' if plan.goal_a_toileting_independent_chk else 'unchecked' }}">è‡ªç«‹</span></div>
                                <div>
                                    <span class="radio {{ 'checked' if plan.goal_a_toileting_assistance_chk else 'unchecked' }}">ä»‹åŠ©</span>
                                    <div class="sub-item">
                                        <div><span class="chk {{ 'checked' if plan.goal_a_toileting_assistance_clothing_chk else 'unchecked' }}">ä¸‹è¡£æ“ä½œ</span></div>
                                        <div><span class="chk {{ 'checked' if plan.goal_a_toileting_assistance_wiping_chk else 'unchecked' }}">æ‹­ãå‹•ä½œ</span></div>
                                        <div><span class="chk {{ 'checked' if plan.goal_a_toileting_assistance_catheter_chk else 'unchecked' }}">ã‚«ãƒ†ãƒ¼ãƒ†ãƒ«</span></div>
                                    </div>
                                </div>
                                <div>
                                    <span class="chk {{ 'checked' if plan.goal_a_toileting_type_chk else 'unchecked' }}">ç¨®é¡</span>
                                    <div class="sub-item">
                                        <div><span class="chk {{ 'checked' if plan.goal_a_toileting_type_western_chk else 'unchecked' }}">æ´‹å¼</span></div>
                                        <div><span class="chk {{ 'checked' if plan.goal_a_toileting_type_japanese_chk else 'unchecked' }}">å’Œå¼</span></div>
                                        <div><span class="chk {{ 'checked' if plan.goal_a_toileting_type_other_chk else 'unchecked' }}">ãã®ä»–</span> (<span class="value-text">{{ plan.goal_a_toileting_type_other_txt or '-' }}</span>)</div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_a_eating_chk else 'unchecked' }}">é£Ÿäº‹</span>
                            <div class="sub-item">
                                <div><span class="radio {{ 'checked' if plan.goal_a_eating_independent_chk else 'unchecked' }}">è‡ªç«‹</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_eating_assistance_chk else 'unchecked' }}">ä»‹åŠ©</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_eating_not_performed_chk else 'unchecked' }}">éå®Ÿæ–½</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_a_eating_method_chopsticks_chk else 'unchecked' }}">ç®¸</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_a_eating_method_fork_etc_chk else 'unchecked' }}">ãƒ•ã‚©ãƒ¼ã‚¯ç­‰</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_a_eating_method_tube_feeding_chk else 'unchecked' }}">èƒƒã‚ã†ã¾ãŸã¯çµŒç®¡</span></div>
                                <div>é£Ÿå½¢æ…‹ (<span class="value-text">{{ plan.goal_a_eating_diet_form_txt or '-' }}</span>)</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_a_grooming_chk else 'unchecked' }}">æ•´å®¹</span>
                            <div class="sub-item">
                                <div><span class="radio {{ 'checked' if plan.goal_a_grooming_independent_chk else 'unchecked' }}">è‡ªç«‹</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_grooming_assistance_chk else 'unchecked' }}">ä»‹åŠ©</span></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_a_dressing_chk else 'unchecked' }}">æ›´è¡£</span>
                            <div class="sub-item">
                                <div><span class="radio {{ 'checked' if plan.goal_a_dressing_independent_chk else 'unchecked' }}">è‡ªç«‹</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_dressing_assistance_chk else 'unchecked' }}">ä»‹åŠ©</span></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_a_bathing_chk else 'unchecked' }}">å…¥æµ´</span>
                            <div class="sub-item">
                                <div><span class="radio {{ 'checked' if plan.goal_a_bathing_independent_chk else 'unchecked' }}">è‡ªç«‹</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_bathing_assistance_chk else 'unchecked' }}">ä»‹åŠ©</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_a_bathing_type_tub_chk else 'unchecked' }}">æµ´æ§½</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_a_bathing_type_shower_chk else 'unchecked' }}">ã‚·ãƒ£ãƒ¯ãƒ¼</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_a_bathing_assistance_body_washing_chk else 'unchecked' }}">æ´—ä½“ä»‹åŠ©</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_a_bathing_assistance_transfer_chk else 'unchecked' }}">ç§»ä¹—ä»‹åŠ©</span></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_a_housework_meal_chk else 'unchecked' }}">å®¶äº‹</span>
                            <div class="sub-item">
                                <div><span class="radio {{ 'checked' if plan.goal_a_housework_meal_all_chk else 'unchecked' }}">å…¨ã¦å®Ÿæ–½</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_housework_meal_not_performed_chk else 'unchecked' }}">éå®Ÿæ–½</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_housework_meal_partial_chk else 'unchecked' }}">ä¸€éƒ¨å®Ÿæ–½</span> (<span class="value-text">{{ plan.goal_a_housework_meal_partial_txt or '-' }}</span>)</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_a_writing_chk else 'unchecked' }}">æ›¸å­—</span>
                            <div class="sub-item">
                                <div><span class="radio {{ 'checked' if plan.goal_a_writing_independent_chk else 'unchecked' }}">è‡ªç«‹</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_writing_independent_after_hand_change_chk else 'unchecked' }}">åˆ©ãæ‰‹äº¤æ›å¾Œè‡ªç«‹</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_writing_other_chk else 'unchecked' }}">ãã®ä»–</span> (<span class="value-text">{{ plan.goal_a_writing_other_txt or '-' }}</span>)</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_a_ict_chk else 'unchecked' }}">PCãƒ»ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ãƒ»ICT</span>
                            <div class="sub-item">
                                <div><span class="radio {{ 'checked' if plan.goal_a_ict_independent_chk else 'unchecked' }}">è‡ªç«‹</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_ict_assistance_chk else 'unchecked' }}">ä»‹åŠ©</span></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_a_communication_chk else 'unchecked' }}">ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³</span>
                            <div class="sub-item">
                                <div><span class="radio {{ 'checked' if plan.goal_a_communication_independent_chk else 'unchecked' }}">è‡ªç«‹</span></div>
                                <div><span class="radio {{ 'checked' if plan.goal_a_communication_assistance_chk else 'unchecked' }}">ä»‹åŠ©</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_a_communication_device_chk else 'unchecked' }}">ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿå™¨</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_a_communication_letter_board_chk else 'unchecked' }}">æ–‡å­—ç›¤</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_a_communication_cooperation_chk else 'unchecked' }}">ä»–è€…ã‹ã‚‰ã®å”åŠ›</span></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th rowspan="3" class="vertical-rl">å¿ƒç†</th>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_s_psychological_support_chk else 'unchecked' }}">ç²¾ç¥çš„æ”¯æ´ (<span class="value-text">{{ plan.goal_s_psychological_support_txt or '-' }}</span>)</span>
                        </td>
                        <td rowspan="3" class="{{ 'liked-item' if details_map.get('goal_s_psychological_action_plan_txt') and details_map.get('goal_s_psychological_action_plan_txt').liked_model }}">
                            <div class="value-text">{{ plan.goal_s_psychological_action_plan_txt or '' }}</div>
                            {% if details_map.get('goal_s_psychological_action_plan_txt') %}
                                {% set detail = details_map.get('goal_s_psychological_action_plan_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.goal_s_psychological_action_plan_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.goal_s_psychological_action_plan_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_s_disability_acceptance_chk else 'unchecked' }}">éšœå®³ã®å—å®¹ (<span class="value-text">{{ plan.goal_s_disability_acceptance_txt or '-' }}</span>)</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_s_psychological_other_chk else 'unchecked' }}">ãã®ä»– (<span class="value-text">{{ plan.goal_s_psychological_other_txt or '-' }}</span>)</span>
                        </td>
                    </tr>
                    <tr>
                        <th rowspan="6" class="vertical-rl">ç’°å¢ƒ</th>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_s_env_home_modification_chk else 'unchecked' }}">è‡ªå®…ã®æ”¹ç¯‰ç­‰ (<span class="value-text">{{ plan.goal_s_env_home_modification_txt or '-' }}</span>)</span>
                        </td>
                        <td rowspan="6" class="{{ 'liked-item' if details_map.get('goal_s_env_action_plan_txt') and details_map.get('goal_s_env_action_plan_txt').liked_model }}">
                            <div class="value-text">{{ plan.goal_s_env_action_plan_txt or '' }}</div>
                            {% if details_map.get('goal_s_env_action_plan_txt') %}
                                {% set detail = details_map.get('goal_s_env_action_plan_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.goal_s_env_action_plan_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.goal_s_env_action_plan_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_s_env_assistive_device_chk else 'unchecked' }}">ç¦ç¥‰æ©Ÿå™¨ã®å°å…¥ (<span class="value-text">{{ plan.goal_s_env_assistive_device_txt or '-' }}</span>)</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_s_env_social_security_chk else 'unchecked' }}">ç¤¾ä¼šä¿éšœã‚µãƒ¼ãƒ“ã‚¹</span>
                            <div class="sub-item">
                                <div><span class="chk {{ 'checked' if plan.goal_s_env_social_security_physical_disability_cert_chk else 'unchecked' }}">èº«éšœæ‰‹å¸³</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_s_env_social_security_disability_pension_chk else 'unchecked' }}">éšœå®³å¹´é‡‘</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_s_env_social_security_intractable_disease_cert_chk else 'unchecked' }}">é›£ç—…ãƒ»å°æ…¢å—çµ¦è€…è¨¼</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_s_env_social_security_other_chk else 'unchecked' }}">ãã®ä»– (<span class="value-text">{{ plan.goal_s_env_social_security_other_txt or '-' }}</span>)</span></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_s_env_care_insurance_chk else 'unchecked' }}">ä»‹è­·ä¿é™ºã‚µãƒ¼ãƒ“ã‚¹ (<span class="value-text">{{ plan.goal_s_env_care_insurance_details_txt or '-' }}</span>)</span>
                            <div class="sub-item">
                                <div><span class="chk {{ 'checked' if plan.goal_s_env_care_insurance_outpatient_rehab_chk else 'unchecked' }}">é€šæ‰€ãƒªãƒ</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_s_env_care_insurance_home_rehab_chk else 'unchecked' }}">è¨ªå•ãƒªãƒ</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_s_env_care_insurance_day_care_chk else 'unchecked' }}">é€šæ‰€ä»‹è­·</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_s_env_care_insurance_home_nursing_chk else 'unchecked' }}">è¨ªå•çœ‹è­·</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_s_env_care_insurance_home_care_chk else 'unchecked' }}">è¨ªå•ä»‹è­·</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_s_env_care_insurance_health_facility_chk else 'unchecked' }}">è€å¥</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_s_env_care_insurance_nursing_home_chk else 'unchecked' }}">ç‰¹é¤Š</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_s_env_care_insurance_care_hospital_chk else 'unchecked' }}">ä»‹è­·åŒ»ç™‚é™¢</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_s_env_care_insurance_other_chk else 'unchecked' }}">ãã®ä»– (<span class="value-text">{{ plan.goal_s_env_care_insurance_other_txt or '-' }}</span>)</span></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_s_env_disability_welfare_chk else 'unchecked' }}">éšœå®³ç¦ç¥‰ã‚µãƒ¼ãƒ“ã‚¹ç­‰</span>
                            <div class="sub-item">
                                <div><span class="chk {{ 'checked' if plan.goal_s_env_disability_welfare_after_school_day_service_chk else 'unchecked' }}">æ”¾èª²å¾Œãƒ‡ã‚¤</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_s_env_disability_welfare_child_development_support_chk else 'unchecked' }}">å…ç«¥ç™ºé”æ”¯æ´ (åŒ»ç™‚ãƒ»ç¦ç¥‰)</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_s_env_disability_welfare_life_care_chk else 'unchecked' }}">ç”Ÿæ´»ä»‹è­·</span></div>
                                <div><span class="chk {{ 'checked' if plan.goal_s_env_disability_welfare_other_chk else 'unchecked' }}">ãã®ä»– (<span class="value-text">{{ plan.goal_s_env_disability_welfare_other_txt or '-' }}</span>)</span></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_s_env_other_chk else 'unchecked' }}">ãã®ä»– (<span class="value-text">{{ plan.goal_s_env_other_txt or '-' }}</span>)</span>
                        </td>
                    </tr>
                    <tr>
                        <th rowspan="4" class="vertical-rl">ç¬¬ä¸‰è€…ã®<br>ä¸åˆ©</th>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_s_3rd_party_main_caregiver_chk else 'unchecked' }}">é€€é™¢å¾Œã®ä¸»ä»‹è­·è€… (<span class="value-text">{{ plan.goal_s_3rd_party_main_caregiver_txt or '-' }}</span>)</span>
                        </td>
                        <td rowspan="4" class="{{ 'liked-item' if details_map.get('goal_s_3rd_party_action_plan_txt') and details_map.get('goal_s_3rd_party_action_plan_txt').liked_model }}">
                            <div class="value-text">{{ plan.goal_s_3rd_party_action_plan_txt or '' }}</div>
                            {% if details_map.get('goal_s_3rd_party_action_plan_txt') %}
                                {% set detail = details_map.get('goal_s_3rd_party_action_plan_txt') %}
                                {% if detail and detail.liked_model %}
                                    {% with suggestions=detail, final_text=plan.goal_s_3rd_party_action_plan_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                {% else %}
                                    <details class="suggestion-details">
                                        <summary>AIææ¡ˆã®æ¯”è¼ƒ â–¶</summary>
                                        {% with suggestions=detail, final_text=plan.goal_s_3rd_party_action_plan_txt %}{% include '_suggestion_details.html' %}{% endwith %}
                                    </details>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_s_3rd_party_family_structure_change_chk else 'unchecked' }}">å®¶æ—æ§‹æˆã®å¤‰åŒ– (<span class="value-text">{{ plan.goal_s_3rd_party_family_structure_change_txt or '-' }}</span>)</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_s_3rd_party_household_role_change_chk else 'unchecked' }}">å®¶åº­å†…å½¹å‰²ã®å¤‰åŒ– (<span class="value-text">{{ plan.goal_s_3rd_party_household_role_change_txt or '-' }}</span>)</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="chk {{ 'checked' if plan.goal_s_3rd_party_family_activity_change_chk else 'unchecked' }}">å®¶æ—ã®ç¤¾ä¼šæ´»å‹•ã®å¤‰åŒ– (<span class="value-text">{{ plan.goal_s_3rd_party_family_activity_change_txt or '-' }}</span>)</span>
                        </td>
                    </tr>
                </tbody>
            </table>

        </div>
    </div>
</body>
</html>